<% content_for :message do %>
<%= t 'user_mailer.challenge_assignment_notification.text.part1', collection_title:@collection.title, collection_url: collection_url(@collection) %>

<%= t 'user_mailer.recipient' %> <%= @request.nil? ? t('user_mailer.challenge_assignment_notification.no_body') : text_pseud(@request.pseud) %>

<%= t 'user_mailer.prompts' %>
<% @request.requests.each_with_index do |prompt, index| %>
<% tag_groups = prompt.tag_groups %>
<% def tag_list(tags) %>
<%  return nil if !tags || tags.empty? %>
<%  tags.map{|tag| tag.name}.to_sentence.html_safe %>
<% end %>
<% fandoms = prompt.any_fandom ? t('user_mailer.any') : tag_list(tag_groups["Fandom"]) %>
<% chars = prompt.any_character ? t('user_mailer.any'): tag_list(tag_groups["Character"]) %>
<% ships = prompt.any_relationship ? t('user_mailer.any') : tag_list(tag_groups["Relationship"]) %>
<% ratings = prompt.any_rating ? t('user_mailer.any') : get_title_string(tag_groups["Rating"]) %>
<% warnings = tag_groups["Warning"] ? get_title_string(tag_groups["Warning"]) : nil %>
<% categories = tag_groups["Category"] ? get_title_string(tag_groups["Category"]) : nil %>
<% atags = tag_list(tag_groups["Freeform"]) %>
<% otags = prompt.optional_tag_set ? tag_list(prompt.optional_tag_set.tags) : nil %>
<%= text_divider %>

<%= index+1 %>. <%= prompt.title %>

<% if fandoms then %><%=t 'user_mailer.fandom'%> <%= fandoms %><% end %><% if chars %>
<%=t 'user_mailer.characters'%> <%= chars %><% end %><% if ships %>
<%=t 'user_mailer.relationships'%> <%= ships %><% end %><% if ratings %>
<%=t 'user_mailer.rating'%> <%= ratings %><% end %><% if warnings %>
<%=t 'user_mailer.warnings'%> <%= warnings %><% end %><% if categories %>
<%=t 'user_mailer.category'%> <%= categories %><% end %><% if atags %>
<%=t 'user_mailer.additional_tags'%> <%= atags %><% end %><% if otags %>
<%=t 'user_mailer.optional_tags'%> <%= otags %><% end %><% if prompt.url && !prompt.url.blank? %>
<%=t 'user_mailer.challenge_assignment_notification.prompt_url'%> <%= prompt.url %><% end %><% if prompt.description && !prompt.description.blank? %>
<%=t 'user_mailer.description'%>
    <%= to_plain_text(prompt.description) %><% end %>

<% end %><%= text_divider %>

<%=t 'user_mailer.challenge_assignment_notification.time_due'%> <%= time_in_zone(@collection.challenge.assignments_due_at, (@collection.challenge.time_zone || Time.zone.name), @assigned_user).gsub(/\n\s*/, "") %>.

<%=t 'user_mailer.challenge_assignment_notification.text.dashboard', user_assignments_url: user_assignments_url(@assigned_user) %>
<% if @collection && !@collection.assignment_notification.blank? %>


<%= @collection.assignment_notification %><% end %><% end %>
<% content_for :footer_note do %><%= t 'user_mailer.challenge_assignment_notification.html.footer', title: @collection.title , collection_url: collection_url(@collection), collection_profile_url: collection_profile_url(@collection) %><%end%>
<% content_for :sent_at do %><%= Time.now.to_s(:time_for_mailers) %><% end %>
