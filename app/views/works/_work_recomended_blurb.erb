  <!--title, author, fandom-->
  <div class="header module blurb">

    <h4 class="heading">
      <% if (work.unrevealed? || work.anonymous?) && is_author_of?(work) %>
        <span class="status">
          <% if work.unrevealed? %>
            <%= ts("Unrevealed:") %>
          <% elsif work.anonymous? %>
            <%= ts("Anonymous:") %>
          <% end %>
        </span>
      <% end %>
      <%= (score*100).to_i %>% match,
      <%= link_to work.title.html_safe, @collection ? collection_work_path(@collection, work) : work %>
      <%= ts('by') %>
        
      <!-- do not cache -->
      <%= byline(work, visibility: "public") %>

      <% tag_groups = work.tag_groups %>

      <% if work.gifts.not_rejected.exists? %>
        <%= ts("for") %> <%= recipients_link(work) %>
      <% end %>
      <% if work.restricted %><%= image_tag("lockblue.png", :size => "15x15", :alt => "(Restricted)", :title => "Restricted") %><% end %>
      <% if work.hidden_by_admin %><%= image_tag("lockred.png", :size => "15x15", :alt => "(Hidden by Admin)", :title => "Hidden by Administrator") %><% end %>
    </h4>

    <h5 class="fandoms heading">
      <span class="landmark"><%= ts("Fandoms") %>:</span>
      <% fandoms = tag_groups['Fandom'] %>
      <%= fandoms.collect{|tag| link_to_tag_works(tag) }.join(', ').html_safe if fandoms %>
      &nbsp;
    </h5>
    <!--required tags-->
    <%= get_symbols_for(work, tag_groups) %>

  <dl class="stats">
    <% if work.language.present? %>
      <dt class="language"><%= ts("Language") %>:</dt>
      <dd class="language"><%= work.language.name %></dd>
    <% end %>
    <dt class="words"><%= ts('Words') %>:</dt>
    <dd class="words"><%= number_with_delimiter(work.word_count) %></dd>
    <dt class="chapters"><%= ts('Chapters') %>:</dt>
    <dd class="chapters"><%= work.chapter_total_display %></dd>
<% #### CACHE stats #### %>
<% cache("#{work.cache_key}/stats", :expires_in => 1.hour) do %>
  <% unless work.approved_collections.empty? %>
    <dt class="collections"><%= ts('Collections') %>:</dt>
    <dd class="collections"><%= link_to work.approved_collections.length, work_collections_path(work) %></dd>
  <% end %>

  <% if work.count_visible_comments > 0 %>
    <dt class="comments"><%= ts('Comments') %>:</dt>
    <dd class="comments"><%= link_to work.count_visible_comments,
                (@collection && false) ? collection_work_path(@collection, work, :anchor => "comments", :show_comments => true) : (work.chapter_total_display.to_i > 1 ? work_path(work, :anchor => "comments", :show_comments => true, :view_full_work => 'true') : work_path(work, :anchor => "comments", :show_comments => true)) %></dd>
  <% end %>
  <% if work.all_kudos_count > 0 %>
    <dt class="kudos"><%= ts('Kudos') %>:</dt>
    <dd class="kudos"><%= link_to work.all_kudos_count.to_s,
        (@collection && false) ? collection_work_path(@collection, work, :anchor => "comments") : 
          (work.chapter_total_display.to_i > 1 ? work_path(work, :anchor => "comments", :view_full_work => 'true') : 
            work_path(work, :anchor => "comments")) %></dd>
  <% end %>
  <% if (bookmark_count = work.public_bookmarks_count) > 0 %>
    <dt class="bookmarks"><%= ts('Bookmarks') %>:</dt>
    <dd class="bookmarks"><%= link_to_bookmarkable_bookmarks(work, bookmark_count.to_s) %></dd>
  <% end %>

  <% if show_hit_count_to_public?(work) %>
    <dt class="hits"><%= ts("Hits") %>:</dt>
    <dd class="hits"><%= work.hits %></dd>
  <% end %>
<% end %>
<% #### END CACHE stats #### %>

  </dl>
  </div>
